table_checks:
  - tb_name: "column_field"
    tb_expected_min_row_count: 300
    tb_expected_max_row_count: 600
  - tb_name: "dataset_resource"
    tb_expected_min_row_count: 90
    tb_expected_max_row_count: 200
  - tb_name: "entity"
    tb_expected_min_row_count: 8500
    tb_expected_max_row_count: 12000
  - tb_name: "fact"
    tb_expected_min_row_count: 80000
    tb_expected_max_row_count: 85000
  - tb_name: "fact_resource"
    tb_expected_min_row_count: 175000
    tb_expected_max_row_count: 185000

field_existence_checks:
  - tb_name: "entity"    
    tb_expected_columns:
      - dataset 
      - end_date 
      - entity 
      - entry_date 
      - geojson 
      - geometry
      - json 
      - name
      - organisation_entity
      - point
      - prefix
      - reference
      - start_date
      - typology

field_level_checks:
  - table_name: entity
    field_name: entity
    expectations:
      - name: expect_values_for_field_to_be_unique
        fields:
          - entity
      - name: expect_values_in_field_to_be_within_range
        min_expected_value: '44000000'
        max_expected_value: '44999999'
        ref_fields:
          - entity

  - table_name: entity
    field_name: geometry    
    expectations: 
      - name: expect_geoshapes_to_be_valid
        ref_fields: 
          - entity
        shape_field: geometry

  - table_name: entity
    field_name: organisation_entity
    expectations:
      - name: expect_row_count_for_lookup_value_to_be_in_range
        count_ranges_per_value:
          - lookup_value: 16 
            min_row_count: 7000
            max_row_count: 8000
          - lookup_value: 109
            min_row_count: 20
            max_row_count: 70
  
  - table_name: entity
    field_name: json 
    expectations: 
      - name: expect_keys_in_json_field_to_be_in_set_of_options
        ref_fields: 
            - entity
        expected_keys_set: 
          - categories
          - documentation-url
          - end-date
          - entity
          - entry-date
          - geometry
          - legislation
          - name
          - notes
          - organisation
          - point
          - reference
          - start-date
          - conservation-area
# TODO implement custom queries in main     
custom_queries:
  - query: "SELECT dataset, entity, typology, reference FROM entity WHERE reference IN (1090769,1090770,1090771,1090772)"
    expected_result: "[
        {'dataset': 'listed-building-outline', 'entity': 42114488, 'typology': 'geography', 'reference': '1090769'}, 
        {'dataset': 'listed-building-outline', 'entity': 42114489, 'typology': 'geography', 'reference': '1090770'}, 
        {'dataset': 'listed-building-outline', 'entity': 42114490, 'typology': 'geography', 'reference': '1090771'}, 
        {'dataset': 'listed-building-outline', 'entity': 42114491, 'typology': 'geography', 'reference': '1090772'}]"
  - query: "SELECT entity FROM entity WHERE within(GeomFromText('POINT(-0.07850740376649457 51.51240013438393)'), GeomFromText(geometry));"
    expected_result: "[{'entity':303443}]"


